<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
<comment>movie-sql.xml</comment>

	<!-- 상영중인 영화 리스트 -->
	<entry key="nowShowing">
		SELECT 
		    MOVIE_NO,
		    MOVIE_TITLE,
		    POSTER_IMG,
		    RELEASE_YEAR,
		    COUNTRY,
		    TICKETING, 
		    AUDIENCE,
		    STAR_RATING
		FROM MOVIE
		JOIN (SELECT MOVIE_NO, ROUND(AVG(STAR_RATING),1) STAR_RATING
		        FROM EVALUATION
		        WHERE EVALUATION_FL ='N'
		        GROUP BY MOVIE_NO) USING (MOVIE_NO)
		WHERE NOW_SHOWING_FL='Y'
		ORDER BY TO_NUMBER(REGEXP_REPLACE(TICKETING, '\%')) DESC
	</entry>
	
	<!-- 전체 영화 리스트 -->
	<entry key="allShow">
		SELECT 
			MOVIE_NO,
			MOVIE_TITLE,
			POSTER_IMG,
			RELEASE_YEAR,
			COUNTRY,
			TICKETING, 
			AUDIENCE
		FROM MOVIE
		WHERE NOW_SHOWING_FL='Y'
		ORDER BY TO_NUMBER(REGEXP_REPLACE(TICKETING, '\%')) DESC
	</entry>
	
	<entry key="selectMovieDetail">
	SELECT MOVIE_TITLE, RELEASE_YEAR, COUNTRY, SYNOPSIS, DETAIL_IMG, POSTER_IMG, DETAIL_IMG
	FROM MOVIE
	WHERE MOVIE_NO = ?
	</entry>
	
	<entry key="movieRating">
	SELECT AVG(STAR_RATING)
	FROM EVALUATION
	WHERE MOVIE_NO = ?
	</entry>
	<entry key="selectComentList">
	SELECT * FROM(
	SELECT ROWNUM RNUM, A.* FROM(
	SELECT COMMENT_NO, MEMBER_NM,COMMENT_CT,
		TO_CHAR(COMMENT_DT, 'YYYY-MM-DD') AS COMMENT_DT
	FROM "COMMENT"
	JOIN MEMBER USING(MEMBER_NO)
	WHERE MOVIE_NO = ?
	AND COMMENT_FL = 'N'
	ORDER BY COMMENT_NO DESC
	)A);
	
	</entry>
	<entry key="movieEvaluate">
	INSERT INTO MOVIE_EVALUATE VALUES ( ?, ?, ?)
	</entry>
	
</properties>
